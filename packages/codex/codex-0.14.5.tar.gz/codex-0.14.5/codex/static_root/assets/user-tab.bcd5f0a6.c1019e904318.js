import{_ as p}from"./change-password-dialog.1b5f1dfe.js";import{A as b,a as C,b as g,_ as m}from"./relation-picker.b591fc2f.js";import{a4 as l,f as c,e as a,b as n,r as _,n as f,g as v}from"./main.4fcfddc1.js";import{D as A}from"./datetime-column.a1ef434e.js";import{o}from"./submit-footer.cc23c169.js";import{_ as u}from"./VCheckbox.bcddaf9a.js";import{b as d}from"./VSelect.2d4a1d93.js";import{_ as k}from"./VSimpleTable.4243fc14.js";import"./confirm-footer.d98372ff.js";import"./index.64fbbd93.js";import"./VSubheader.0f3b6a5f.js";import"./confirm-dialog.ea1919f7.js";import"./datetime.5fb8de45.js";import"./VInput.84b33d44.js";import"./index.35e9824f.js";const w=["username","isStaff","isActive","groups"];Object.freeze(w);const i={username:"",password:"",passwordConfirm:"",isStaff:!1,isActive:!0,groups:[]};Object.freeze(i);const y={name:"AdminUserCreateUpdateInputs",components:{AdminRelationPicker:b},props:{oldRow:{type:[Object,Boolean],default:!1}},emits:["change"],data(){return{rules:{username:[r=>!!r||"Username is required",r=>!!r&&!this.usernames.has(r.trim())||"Username already used"],password:[r=>!!r||"Password is required"],passwordConfirm:[r=>r===this.row.password||"Passwords must match"]},row:l.cloneDeep(this.oldRow||i)}},computed:{...c(a,["vuetifyGroups"]),...n(a,{users:r=>r.users}),usernames(){return this.nameSet(this.users,"username",this.oldRow,!0)}},watch:{row:{handler(r){this.$emit("change",r)},deep:!0},oldRow:{handler(r){this.row=l.cloneDeep(r)},deep:!0}},methods:{..._(a,["nameSet"])},UPDATE_KEYS:w,EMPTY_ROW:i};var D=function(){var e=this,s=e._self._c;return s("div",[s(o,{attrs:{autocomplete:"username",label:"Username",rules:e.rules.username,clearable:"",autofocus:""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.$refs.password.focus()}},model:{value:e.row.username,callback:function(t){e.$set(e.row,"username",t)},expression:"row.username"}}),e.oldRow?e._e():s("div",[s(o,{ref:"password",attrs:{autocomplete:"new-password",label:"Password",rules:e.rules.password,clearable:"",type:"password"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.$refs.passwordConfirm.focus()}},model:{value:e.row.password,callback:function(t){e.$set(e.row,"password",t)},expression:"row.password"}}),s(o,{ref:"passwordConfirm",attrs:{autocomplete:"new-password",label:"Confirm Password",rules:e.rules.passwordConfirm,clearable:"",type:"password"},model:{value:e.row.passwordConfirm,callback:function(t){e.$set(e.row,"passwordConfirm",t)},expression:"row.passwordConfirm"}})],1),s(u,{attrs:{label:"Is Staff",ripple:""},model:{value:e.row.isStaff,callback:function(t){e.$set(e.row,"isStaff",t)},expression:"row.isStaff"}}),s(u,{attrs:{label:"Is Active",ripple:""},model:{value:e.row.isActive,callback:function(t){e.$set(e.row,"isActive",t)},expression:"row.isActive"}}),s("AdminRelationPicker",{attrs:{label:"Groups",items:e.vuetifyGroups},model:{value:e.row.groups,callback:function(t){e.$set(e.row,"groups",t)},expression:"row.groups"}})],1)},U=[],x=f(y,D,U,!1,null,null,null,null);const R=x.exports;const S=96+16,T=36,E=24,H=S+T+E,h=48,$=h*2,I={name:"AdminUsersTab",components:{AdminDeleteRowDialog:C,ChangePasswordDialog:p,AdminCreateUpdateDialog:g,DateTimeColumn:A,RelationChips:m},props:{innerHeight:{type:Number,required:!0}},data(){return{AdminUserCreateUpdateInputs:R}},computed:{...c(a,["groupMap"]),...n(a,{users:r=>r.users,tableMaxHeight:r=>(r.users.length+1)*h}),...n(v,{me:r=>r.user}),tableHeight(){const r=this.innerHeight-H;return this.tableMaxHeight<r?void 0:Math.max(r,$)}},mounted(){this.loadTables(["Group","User"])},methods:{..._(a,["loadTables"])}};var P=function(){var e=this,s=e._self._c;return s("div",[s("header",{staticClass:"tabHeader"},[s("AdminCreateUpdateDialog",{attrs:{table:"User",inputs:e.AdminUserCreateUpdateInputs,"max-width":"20em"}})],1),s(k,{staticClass:"highlight-simple-table admin-table",attrs:{"fixed-header":"",height:e.tableHeight},scopedSlots:e._u([{key:"default",fn:function(){return[s("thead",[s("tr",[s("th",[e._v("Username")]),s("th",[e._v("Staff")]),s("th",[e._v("Active")]),s("th",[e._v("Groups")]),s("th",[e._v("Last Login")]),s("th",[e._v("Joined")]),s("th",[e._v("Edit")]),s("th",[e._v("Change Password")]),s("th",[e._v("Delete")])])]),s("tbody",e._l(e.users,function(t){return s("tr",{key:`u:${t.pk}:${t.keyHack}`},[s("td",{staticClass:"usernameCol"},[e._v(" "+e._s(t.username)+" ")]),s("td",{staticClass:"buttonCol"},[s(d,{attrs:{value:t.isStaff,dense:"",disabled:""}})],1),s("td",{staticClass:"buttonCol"},[s(d,{attrs:{value:t.isActive,dense:"",disabled:""}})],1),s("td",{staticClass:"relationCol"},[s(m,{attrs:{pks:t.groups,map:e.groupMap}})],1),s("td",{staticClass:"dttmCol"},[s("DateTimeColumn",{attrs:{dttm:t.lastLogin}})],1),s("td",{staticClass:"dttmCol"},[s("DateTimeColumn",{attrs:{dttm:t.dateJoined}})],1),s("td",{staticClass:"buttonCol"},[s("AdminCreateUpdateDialog",{attrs:{table:"User",inputs:e.AdminUserCreateUpdateInputs,"old-row":t,"max-width":"20em"}})],1),s("td",{staticClass:"buttonCol"},[s(p,{attrs:{user:t,"is-admin-mode":!0}})],1),s("td",{staticClass:"buttonCol"},[e.me.id!==t.pk?s("AdminDeleteRowDialog",{attrs:{table:"User",pk:t.pk,name:t.username}}):e._e()],1)])}),0)]},proxy:!0}])})],1)},G=[],O=f(I,P,G,!1,null,"b348932e",null,null);const Z=O.exports;export{Z as default};
