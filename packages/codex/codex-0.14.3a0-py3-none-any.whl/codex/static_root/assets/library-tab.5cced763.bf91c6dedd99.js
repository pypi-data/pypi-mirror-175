import{_ as $}from"./confirm-dialog.0a7151ce.js";import{A as B,a as M,b as L,_ as k}from"./relation-picker.f1b646bb.js";import{p as I,V as S,m as P,o as U,a6 as z,a7 as W,a8 as G,a9 as j,aa as N}from"./submit-footer.4e25f04d.js";import{j as m,m as d,h as l,a as f,C as V,x as Y,k as q,b as o,e as a,n as r,q as _,r as c,a4 as v,f as F}from"./main.bc7f684f.js";import{D as T}from"./datetime-column.e339ab1e.js";import{B as g}from"./VItemGroup.103183dd.js";import{f as X,B as K,D as Z,h as J,A as Q,c as ee}from"./confirm-footer.fd7b667d.js";import{p as te,i as D,C as u,r as se,_ as p}from"./index.e954868e.js";import{_ as E}from"./VSimpleTable.8a9af157.js";import{M as ie,b}from"./VSelect.48bf28dd.js";import{_ as ne}from"./VCombobox.8097d9b0.js";import{_ as x}from"./VCheckbox.0a6cd5b8.js";import{a as ae}from"./datetime.5fb8de45.js";import"./VSubheader.c5eecff9.js";import"./VInput.56b67ace.js";import"./index.5b23bdea.js";const y=g.extend({name:"v-expansion-panels",provide(){return{expansionPanels:this}},props:{accordion:Boolean,disabled:Boolean,flat:Boolean,hover:Boolean,focusable:Boolean,inset:Boolean,popout:Boolean,readonly:Boolean,tile:Boolean},computed:{classes(){return{...g.options.computed.classes.call(this),"v-expansion-panels":!0,"v-expansion-panels--accordion":this.accordion,"v-expansion-panels--flat":this.flat,"v-expansion-panels--hover":this.hover,"v-expansion-panels--focusable":this.focusable,"v-expansion-panels--inset":this.inset,"v-expansion-panels--popout":this.popout,"v-expansion-panels--tile":this.tile}}},created(){this.$attrs.hasOwnProperty("expand")&&m("expand","multiple",this),Array.isArray(this.value)&&this.value.length>0&&typeof this.value[0]=="boolean"&&m(':value="[true, false, true]"',':value="[0, 2]"',this)},methods:{updateItem(t,e){const s=this.getValue(t,e),i=this.getValue(t,e+1);t.isActive=this.toggleMethod(s),t.nextIsActive=this.toggleMethod(i)}}}),w=d(X("expansionPanels","v-expansion-panel","v-expansion-panels"),te("expansionPanel",!0)).extend({name:"v-expansion-panel",props:{disabled:Boolean,readonly:Boolean},data(){return{content:null,header:null,nextIsActive:!1}},computed:{classes(){return{"v-expansion-panel--active":this.isActive,"v-expansion-panel--next-active":this.nextIsActive,"v-expansion-panel--disabled":this.isDisabled,...this.groupClasses}},isDisabled(){return this.expansionPanels.disabled||this.disabled},isReadonly(){return this.expansionPanels.readonly||this.readonly}},methods:{registerContent(t){this.content=t},unregisterContent(){this.content=null},registerHeader(t){this.header=t,t.$on("click",this.onClick)},unregisterHeader(){this.header=null},onClick(t){t.detail&&this.header.$el.blur(),this.$emit("click",t),this.isReadonly||this.isDisabled||this.toggle()},toggle(){this.$nextTick(()=>this.$emit("change"))}},render(t){return t("div",{staticClass:"v-expansion-panel",class:this.classes,attrs:{"aria-expanded":String(this.isActive)}},l(this))}}),oe=d(K,u,D("expansionPanel","v-expansion-panel-content","v-expansion-panel")),A=oe.extend().extend({name:"v-expansion-panel-content",data:()=>({isActive:!1}),computed:{parentIsActive(){return this.expansionPanel.isActive}},watch:{parentIsActive:{immediate:!0,handler(t,e){t&&(this.isBooted=!0),e==null?this.isActive=t:this.$nextTick(()=>this.isActive=t)}}},created(){this.expansionPanel.registerContent(this)},beforeDestroy(){this.expansionPanel.unregisterContent()},render(t){return t(I,this.showLazyContent(()=>[t("div",this.setBackgroundColor(this.color,{staticClass:"v-expansion-panel-content",directives:[{name:"show",value:this.isActive}]}),[t("div",{class:"v-expansion-panel-content__wrap"},l(this))])]))}}),re=d(u,D("expansionPanel","v-expansion-panel-header","v-expansion-panel")),C=re.extend().extend({name:"v-expansion-panel-header",directives:{ripple:se},props:{disableIconRotate:Boolean,expandIcon:{type:String,default:"$expand"},hideActions:Boolean,ripple:{type:[Boolean,Object],default:!1}},data:()=>({hasMousedown:!1}),computed:{classes(){return{"v-expansion-panel-header--active":this.isActive,"v-expansion-panel-header--mousedown":this.hasMousedown}},isActive(){return this.expansionPanel.isActive},isDisabled(){return this.expansionPanel.isDisabled},isReadonly(){return this.expansionPanel.isReadonly}},created(){this.expansionPanel.registerHeader(this)},beforeDestroy(){this.expansionPanel.unregisterHeader()},methods:{onClick(t){this.$emit("click",t)},genIcon(){const t=l(this,"actions")||[this.$createElement(p,this.expandIcon)];return this.$createElement(S,[this.$createElement("div",{staticClass:"v-expansion-panel-header__icon",class:{"v-expansion-panel-header__icon--disable-rotate":this.disableIconRotate},directives:[{name:"show",value:!this.isDisabled}]},t)])}},render(t){return t("button",this.setBackgroundColor(this.color,{staticClass:"v-expansion-panel-header",class:this.classes,attrs:{tabindex:this.isDisabled?-1:null,type:"button","aria-expanded":this.isActive},directives:[{name:"ripple",value:this.ripple}],on:{...this.$listeners,click:this.onClick,mousedown:()=>this.hasMousedown=!0,mouseup:()=>this.hasMousedown=!1}}),[l(this,"default",{open:this.isActive},!0),this.hideActions||this.genIcon()])}});const le=d(u,J,Z,ie).extend({name:"v-tooltip",props:{closeDelay:{type:[Number,String],default:0},disabled:Boolean,openDelay:{type:[Number,String],default:0},openOnHover:{type:Boolean,default:!0},openOnFocus:{type:Boolean,default:!0},tag:{type:String,default:"span"},transition:String},data:()=>({calculatedMinWidth:0,closeDependents:!1}),computed:{calculatedLeft(){const{activator:t,content:e}=this.dimensions,s=!this.bottom&&!this.left&&!this.top&&!this.right,i=this.attach!==!1?t.offsetLeft:t.left;let n=0;return this.top||this.bottom||s?n=i+t.width/2-e.width/2:(this.left||this.right)&&(n=i+(this.right?t.width:-e.width)+(this.right?10:-10)),this.nudgeLeft&&(n-=parseInt(this.nudgeLeft)),this.nudgeRight&&(n+=parseInt(this.nudgeRight)),`${this.calcXOverflow(n,this.dimensions.content.width)}px`},calculatedTop(){const{activator:t,content:e}=this.dimensions,s=this.attach!==!1?t.offsetTop:t.top;let i=0;return this.top||this.bottom?i=s+(this.bottom?t.height:-e.height)+(this.bottom?10:-10):(this.left||this.right)&&(i=s+t.height/2-e.height/2),this.nudgeTop&&(i-=parseInt(this.nudgeTop)),this.nudgeBottom&&(i+=parseInt(this.nudgeBottom)),this.attach===!1&&(i+=this.pageYOffset),`${this.calcYOverflow(i)}px`},classes(){return{"v-tooltip--top":this.top,"v-tooltip--right":this.right,"v-tooltip--bottom":this.bottom,"v-tooltip--left":this.left,"v-tooltip--attached":this.attach===""||this.attach===!0||this.attach==="attach"}},computedTransition(){return this.transition?this.transition:this.isActive?"scale-transition":"fade-transition"},offsetY(){return this.top||this.bottom},offsetX(){return this.left||this.right},styles(){return{left:this.calculatedLeft,maxWidth:f(this.maxWidth),minWidth:f(this.minWidth),top:this.calculatedTop,zIndex:this.zIndex||this.activeZIndex}}},beforeMount(){this.$nextTick(()=>{this.value&&this.callActivate()})},mounted(){V(this,"activator",!0)==="v-slot"&&Y(`v-tooltip's activator slot must be bound, try '<template #activator="data"><v-btn v-on="data.on>'`,this)},methods:{activate(){this.updateDimensions(),requestAnimationFrame(this.startTransition)},deactivate(){this.runDelay("close")},genActivatorListeners(){const t=Q.options.methods.genActivatorListeners.call(this);return this.openOnFocus&&(t.focus=e=>{this.getActivator(e),this.runDelay("open")},t.blur=e=>{this.getActivator(e),this.runDelay("close")}),t.keydown=e=>{e.keyCode===q.esc&&(this.getActivator(e),this.runDelay("close"))},t},genActivatorAttributes(){return{"aria-haspopup":!0,"aria-expanded":String(this.isActive)}},genTransition(){const t=this.genContent();return this.computedTransition?this.$createElement("transition",{props:{name:this.computedTransition}},[t]):t},genContent(){return this.$createElement("div",this.setBackgroundColor(this.color,{staticClass:"v-tooltip__content",class:{[this.contentClass]:!0,menuable__content__active:this.isActive,"v-tooltip__content--fixed":this.activatorFixed},style:this.styles,attrs:this.getScopeIdAttrs(),directives:[{name:"show",value:this.isContentActive}],ref:"content"}),this.getContentSlot())}},render(t){return t(this.tag,{staticClass:"v-tooltip",class:this.classes},[this.showLazyContent(()=>[this.genTransition()]),this.genActivator()])}});const ce={name:"AdminFailedImportsPanel",components:{DateTimeColumn:T},data(){return{mdiOpenInNew:P}},computed:{...o(a,{failedImports:t=>t.failedImports})}};var de=function(){var e=this,s=e._self._c;return e.failedImports&&e.failedImports.length>0?s("div",{attrs:{id:"failedImports"}},[s(y,[s(w,{attrs:{id:"failedImportsPanel"}},[s(C,[s("h4",[e._v("Failed Imports: "+e._s(e.failedImports.length))])]),s(A,[s(E,{staticClass:"highlight-simple-table",attrs:{"fixed-header":""},scopedSlots:e._u([{key:"default",fn:function(){return[s("thead",[s("tr",[s("th",[e._v("Path")]),s("th",[e._v("Created")])])]),s("tbody",e._l(e.failedImports,function(i){return s("tr",{key:`fi:${i.path}`},[s("td",[e._v(" "+e._s(i.path)+" ")]),s("td",{staticClass:"dateCol"},[s("DateTimeColumn",{attrs:{dttm:i.createdAt}})],1)])}),0)]},proxy:!0}],null,!1,2477573198)}),s(y,[s(w,{attrs:{id:"failedImportsHelp"}},[s(C,[s("h4",[e._v("Failed Imports Help")])]),s(A,[s("p",[e._v(" These are Comic archives that have failed to import. This list is updated every time the library updates. You should probably review these files and fix or remove them. ")]),s("h4",[e._v("Fixing comics")]),s("p",[e._v(" Try using the zip fixer to fix comics: "),s("code",{staticClass:"cli"},[e._v(" cp problem-comic.cbz /somewhere/safe/problem-comic.cbz.backup"),s("br"),e._v(" zip -F problem-comic.cbz --out fixed.zip"),s("br"),e._v(" mv fixed.zip problem-comic.cbz ")]),e._v(" You may also try "),s("code",[e._v("zip -FF")]),e._v(" to fix comics which uses a different (not necissarily better) algorithm. If you fix some imports, and Codex does not immediately detect the change, poll the library which contains the fixed comics. ")]),s("h4",[e._v("Reporting Issues")]),s("p",[e._v(" If the comic looks good to you, but still shows up as a failed import, it might be Codex's fault for not importing it correctly. Please file an "),s("a",{attrs:{href:"https://github.com/ajslater/codex/issues/",target:"_blank"}},[e._v("Issue Report"),s(p,{attrs:{small:""}},[e._v(e._s(e.mdiOpenInNew))])],1),e._v(" and include the stack trace from the logs at "),s("code",[e._v("config/logs/codex.log")]),e._v(" if you can. ")])])],1)],1)],1)],1)],1)],1):e._e()},pe=[],he=r(ce,de,pe,!1,null,"0c23927a",null,null);const ue=he.exports,me={name:"TimeTextField",data(){return{timeRules:[t=>/^([01]?\d|2[0-4]):([0-5]\d)(:[0-5]\d)?:([0-5]\d)(:[0-5]\d)?$/.test(t)||"Invalid time format HH:mm:SS"]}}};var fe=function(){var e=this,s=e._self._c;return s(U,e._g(e._b({ref:"timeField",attrs:{dense:"",round:"",filled:"",rules:e.timeRules}},"v-text-field",e.$attrs,!1),e.$listeners))},_e=[],ve=r(me,fe,_e,!1,null,null,null,null);const H=ve.exports;const ge={name:"AdminServerFolderPicker",emits:["change","menu"],data(){return{path:"",showHidden:!1,menuOpen:!1,mdiFileTree:z,mdiFolderHidden:W,mdiFolderOutline:G}},computed:{...o(a,{folders:t=>t.folderPicker.folders,rootFolder:t=>t.folderPicker.rootFolder}),...o(_,{formErrors:t=>t.form.errors}),appendOuterIcon:function(){return this.showHidden?this.mdiFolderHidden:this.mdiFolderOutline},showHiddenTooltipPrefix:function(){return this.showHidden?"Hide":"Show"}},watch:{menuOpen(t){t&&this.$emit("menu",t)}},created(){this.loadFolders().then(()=>(this.path=this.rootFolder,!0)).catch(console.warn)},methods:{...c(a,["loadFolders"]),...c(_,["clearErrors"]),change:function(t){const e=t?t.startsWith("/")?t:[this.rootFolder,t].join("/"):this.rootFolder,s=this.$refs.folderPicker.isMenuActive;this.clearErrors(),this.loadFolders(e,this.showHidden).then(()=>(this.path=this.rootFolder,this.$refs.folderPicker.isMenuActive=s,this.$emit("change",this.path))).catch(console.warn)},toggleMenu:function(t){t===void 0&&(t=!this.menuOpen),this.menuOpen=t,this.$refs.folderPicker.isMenuActive=t},toggleHidden:function(){this.showHidden=!this.showHidden,this.change(this.path)}}};var be=function(){var e=this,s=e._self._c;return s(ne,e._g(e._b({ref:"folderPicker",staticClass:"folderPicker",attrs:{"auto-select-first":"",filled:"","append-icon":e.mdiFileTree,items:e.folders,"error-messages":e.formErrors,"menu-props":{value:e.menuOpen,maxHeight:"75%"}},on:{blur:function(i){return e.toggleMenu(!1)},change:e.change,"click:append":function(i){return e.toggleMenu()},focus:e.clearErrors},scopedSlots:e._u([{key:"append-outer",fn:function(){return[s(le,{attrs:{top:"","open-delay":2e3},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:n}){return[s(p,e._g(e._b({on:{click:e.toggleHidden}},"v-icon",n,!1),i),[e._v(" "+e._s(e.appendOuterIcon)+" ")])]}}])},[s("span",[e._v(e._s(e.showHiddenTooltipPrefix)+" Hidden Folders")])])]},proxy:!0}]),model:{value:e.path,callback:function(i){e.path=i},expression:"path"}},"v-combobox",e.$attrs,!1),e.$listeners))},xe=[],ye=r(ge,be,xe,!1,null,"119443a2",null,null);const we=ye.exports;const R=["events","poll","pollEvery","groups"];Object.freeze(R);const h={path:"",events:!0,poll:!0,pollEvery:"01:00:00",groups:[]};Object.freeze(h);const Ae={name:"AdminLibraryCreateUpdateInputs",components:{AdminRelationPicker:B,AdminServerFolderPicker:we,TimeTextField:H},props:{oldRow:{type:[Object,Boolean],default:!1}},data(){return{rules:{path:[t=>!!t||"Path is required",t=>{if(!t)return!1;for(const e of this.paths){if(t.startsWith(e))return"Path is a child of an existing library";if(e.startsWith(t))return"Path is a parent of an existing library"}return!0}]},row:v.cloneDeep(this.oldRow||h),folderMenuOpen:!1}},computed:{...F(a,["vuetifyGroups"]),...o(a,{libraries:t=>t.libraries}),paths(){return this.nameSet(this.libraries,"path",this.oldRow,!1)}},watch:{row:{handler(t){this.$emit("change",t)},deep:!0},oldRow:{handler(t){this.row=v.cloneDeep(t)},deep:!0}},methods:{...c(a,["nameSet"])},UPDATE_KEYS:R,EMPTY_ROW:h};var Ce=function(){var e=this,s=e._self._c;return s("div",{class:{tallForPicker:e.folderMenuOpen},attrs:{id:"libraryInputs"}},[e.oldRow?s("div",[e._v(e._s(e.oldRow.path))]):s("AdminServerFolderPicker",{attrs:{rules:e.rules.path,autofocus:"",label:"Library Folder"},on:{change:function(i){e.row.path=i},menu:function(i){e.folderMenuOpen=e.folderMenuOpen||i}}}),s(x,{attrs:{label:"Watch Filesystem Events",ripple:"",hint:"Update Codex instantly when the filesystem changes","persistent-hint":!0},model:{value:e.row.events,callback:function(i){e.$set(e.row,"events",i)},expression:"row.events"}}),s(x,{attrs:{label:"Poll Filesystem",ripple:"",hint:"Periodically poll the library for changes","persistent-hint":!0},model:{value:e.row.poll,callback:function(i){e.$set(e.row,"poll",i)},expression:"row.poll"}}),s(H,{attrs:{label:"Poll Every",disabled:!e.row.poll},model:{value:e.row.pollEvery,callback:function(i){e.$set(e.row,"pollEvery",i)},expression:"row.pollEvery"}}),s("AdminRelationPicker",{attrs:{label:"Groups",items:e.vuetifyGroups},model:{value:e.row.groups,callback:function(i){e.$set(e.row,"groups",i)},expression:"row.groups"}})],1)},$e=[],ke=r(Ae,Ce,$e,!1,null,"878bfea8",null,null);const Ie=ke.exports;const Pe=96+16,Fe=36,Te=24,De=60+48+64,Ee=Pe+Fe+De+Te,O=48,He=O*2,Re={name:"AdminLibrariesTab",components:{AdminDeleteRowDialog:M,AdminFailedImportsPanel:ue,AdminCreateUpdateDialog:L,RelationChips:k,ConfirmDialog:$,DateTimeColumn:T},props:{innerHeight:{type:Number,required:!0}},data(){return{lastUpdate:{pk:0,field:void 0},mdiDatabaseClockOutline:j,mdiDatabaseImportOutline:N,mdiOpenInNew:P,AdminLibraryCreateUpdateInputs:Ie}},computed:{...F(a,["groupMap"]),...o(a,{libraries:t=>t.libraries,formErrors:t=>t.form.errors,tableMaxHeight:t=>(t.libraries.length+1)*O}),tableHeight(){const t=this.innerHeight-Ee;return this.tableMaxHeight<t?void 0:Math.max(t,He)}},mounted(){this.loadTables(["Group","Library","FailedImport"])},methods:{...c(a,["updateRow","clearErrors","librarianTask","loadTables"]),formatDateTime:t=>t?ae.format(new Date(t)):"",changeCol(t,e,s){this.lastUpdate.pk=t,this.lastUpdate.field=e;const i={[e]:s};this.updateRow("Library",t,i)},getFormErrors(t,e){if(t===this.lastUpdate.pk&&e===this.lastUpdate.field)return this.formErrors},poll(t){this.librarianTask("poll",`Poll Library ${t}`,t)},forcePoll(t){this.librarianTask("poll_force",`Force Poll Library ${t}`,t)}}};var Oe=function(){var e=this,s=e._self._c;return s("div",[s("header",{staticClass:"tabHeader"},[s("AdminCreateUpdateDialog",{attrs:{table:"Library",inputs:e.AdminLibraryCreateUpdateInputs,"max-width":"22em"}})],1),s(E,{staticClass:"highlight-simple-table admin-table",attrs:{"fixed-header":"",height:e.tableHeight},scopedSlots:e._u([{key:"default",fn:function(){return[s("thead",[s("tr",[s("th",[e._v("Path")]),s("th",[e._v("Watch Filesystem Events")]),s("th",[e._v("Poll Filesystem")]),s("th",[e._v("Poll Every")]),s("th",[e._v("Last Poll")]),s("th",[e._v("Groups")]),s("th",[e._v("Poll for Updates Now")]),s("th",[e._v("Force Update")]),s("th",[e._v("Edit")]),s("th",[e._v("Delete")])])]),s("tbody",e._l(e.libraries,function(i){return s("tr",{key:i.pk},[s("td",[e._v(e._s(i.path))]),s("td",[s(b,{attrs:{value:i.events,dense:"",disabled:""}})],1),s("td",[s(b,{attrs:{value:i.poll,dense:"",disabled:""}})],1),s("td",{staticClass:"pollEveryCol",class:{disabled:!i.poll}},[e._v(" "+e._s(i.pollEvery)+" ")]),s("td",{staticClass:"dateCol"},[s("DateTimeColumn",{attrs:{dttm:i.lastPoll}})],1),s("td",[s(k,{attrs:{pks:i.groups,map:e.groupMap}})],1),s("td",[s(ee,{attrs:{icon:"",ripple:""},on:{click:function(n){return e.poll(i.pk)}}},[s(p,[e._v(e._s(e.mdiDatabaseClockOutline))])],1)],1),s("td",[s($,{attrs:{icon:e.mdiDatabaseImportOutline,"title-text":"Force Update Library","object-name":i.path,"confirm-text":"Force Update"},on:{confirm:function(n){return e.forcePoll(i.pk)}}})],1),s("td",[s("AdminCreateUpdateDialog",{attrs:{table:"Library","old-row":i,inputs:e.AdminLibraryCreateUpdateInputs,"max-width":"22em"}})],1),s("td",[s("AdminDeleteRowDialog",{attrs:{table:"Library",pk:i.pk,name:i.path}})],1)])}),0)]},proxy:!0}])}),s(I,[s("AdminFailedImportsPanel")],1)],1)},Be=[],Me=r(Re,Oe,Be,!1,null,"6f7cdb73",null,null);const et=Me.exports;export{et as default};
