service: integracao-bling-dfb

frameworkVersion: "3"

provider:
  name: aws
  runtime: python3.8
  region: sa-east-1
  architecture: arm64
  tags:
    app-environment: ${opt:stage, "dev"}
    app-id: NFe na rede
    app-module: bling
    app-owner: bnsouza
    app-service: Integração
    app-aws-service: Lambda Function
  timeout: 270
  environment:
    MYSQLG3_HOST: ${self:custom.g3-mysql.host, env:MYSQLG3_HOST}
    MYSQLG3_PASS: ${self:custom.g3-mysql.usuario, env:MYSQLG3_PASS}
    MYSQLG3_USER: ${self:custom.g3-mysql.senha, env:MYSQLG3_USER}

custom:
  stage: ${opt:stage, "dev"}
  g3-mysql: ${ssm:/aws/reference/secretsmanager/nfenarede/${self:custom.stage}/g3-mysql}
  pythonRequirements:
    dockerizePip: true
    usePoetry: false
    slim: true
    strip: false

functions:
  cron:
    events:
      - schedule: rate(5 minutes)
    handler: cron.handler
    layers:
      - "arn:aws:lambda:sa-east-1:017000801446:layer:AWSLambdaPowertoolsPythonV2-Arm64:12"
      - "arn:aws:lambda:sa-east-1:851721876455:layer:nfenarede-mysql:3"

package:
  individually: true
  excludeDevDependencies: true
  patterns:
    - "!.docker"
    - "!.idea"
    - "!Makefile"
    - "!node_modules/**"
    - "!package-lock.json"
    - "!package.json"
    - "!README.md"
    - "!requirements.txt"

plugins:
  - serverless-offline
  - serverless-python-requirements
  - serverless-domain-manager